<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de M√∫sica y Danza</title>
    <link id="tema" rel="stylesheet" href="bootstrap.min.cerulean.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://ilovebiodanza.top/css/main.css">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/sonification.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://ilovebiodanza.top/js/musicaDB.js"></script>
    <script>const admin=false; const module="Music and dances"</script>
    <script src="https://ilovebiodanza.top/js/util.js"></script>
    <script src="https://ilovebiodanza.top/js/moverEstructuras.class.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script>const language= "es";</script>
    <script src="https://ilovebiodanza.top/js/lang.js"></script>
</head>
<body id="mb">
    <div  style="position: fixed; bottom: 10px; right: 10px; z-index: 9999;">
        <audio is="amo-biodanza-audio" analyst preload="none" id="audio-music" class="d-none"></audio>
    </div>

    <div class="container mt-2">
        <!-- Header -->
        <div class="bg-primary text-white rounded p-4 mb-2 text-center">
            <h1 class="display-5 fw-bold mb-3 lang">Yo<span class="text-danger">‚ù§</span>Biodanza</h1>
            <p class="lead mb-4">Explora nuestra üé∂ M√∫sica üéµ y üíÉ Danza üï∫</p>
            
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="input-group input-group-lg shadow-sm">
                        <input type="text" id="searchInput" class="form-control border-0" placeholder="üîç Buscar por t√≠tulo, autor, danza o l√≠nea...">
                        <div class="input-group-append">
                            <button class="btn btn-light" type="button" onclick="playRandomMusic()">
                                <i class="bi bi-shuffle"></i>
                                <span class="badge bg-primary ms-1" id="random-monitor">0/0</span>
                            </button>  
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Barra de Estad√≠sticas -->
        <div class="bg-light rounded p-3 mb-3 d-flex justify-content-between align-items-center">
            <div>
                <span class="text-muted" id="total-registros"><strong>0</strong> items</span>
            </div>
            <div class="form-check">
                <input title="Mostrar solo seleccionados" class="form-check-input" type="checkbox" id="filterChecked">
                <label class="form-check-label text-muted" for="filterChecked">
                    Mostrar solo seleccionados
                </label> 
            </div>

        </div>

        <!-- Navegaci√≥n -->
        <nav aria-label="Navegaci√≥n de p√°ginas">
            <ul class="pagination pagination-sm justify-content-center" id="pagination">
                <!-- Los botones de paginaci√≥n se insertar√°n aqu√≠ -->
            </ul>
        </nav>

        <!-- Tabla -->
        <div class="bg-white rounded shadow-sm">
            <div class="table-responsive">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th width="60"></th>
                            <th onclick="sortTable('m.code')" class="sortable">C√≥digo</th>
                            <th>üé∂ M√∫sica üéµ <span onclick="sortTable('m.title')" class="sortable">T√≠tulo</span> / 
                            <span onclick="sortTable('m.author')" class="sortable">Autor</span></th>
                            <th onclick="sortTable('d.title')" class="sortable">üíÉ Danza üï∫</th>
                            <th onclick="sortTable('m.line')" class="sortable">L√≠nea</th>
                            <th width="80" class="text-center">
                                <i class="bi bi-check-square" title="Seleccionar"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <!-- Los datos se insertar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Panel de Clipboard -->
        <div class="invisible mt-3" id="clickboard">
            <div class="alert alert-info d-flex justify-content-between align-items-center">
                <div>
                    <i class="bi bi-clipboard-check"></i>
                    <span id="selected-count">0 elementos seleccionados</span>
                </div>
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="copyToClipboard()">
                    <i class="bi bi-clipboard"></i> Copiar al portapapeles
                </button>
            </div>
        </div>
    </div>

    <!-- Modales -->
    <div class="modal fade" id="danceModal" tabindex="-1" role="dialog" aria-labelledby="danceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="danceModalLabel">Detalles de la Danza</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="danceModalBody">
                    <!-- Los detalles del danzo se insertar√°n aqu√≠ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="musicModal" tabindex="-1" role="dialog" aria-labelledby="musicModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="musicModalLabel">Detalles de la M√∫sica</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="musicModalBody">
                    <!-- Los detalles de la m√∫sica se insertar√°n aqu√≠ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script id="ms">
// =============================================
// M√≥dulo: Configuraci√≥n y Constantes
// =============================================
const AppConfig = {
    admin: false,
    module: "Music and dances",
    language: "es",
    itemsPerPage: 30,
    baseUrl: 'https://ilovebiodanza.github.io/catalogo/data/',
    themes: [
        'cerulean', 'ciborg', 'cosmo', 'darkly', 'flatly', 
        'journal', 'litera', 'lumen', 'lux', 'materia', 
        'minty', 'pulse', 'sandstone', 'simplex', 'sketchy', 
        'slate', 'solar', 'spacelab', 'superhero', 'united', 
        'yeti'
    ]
};

// =============================================
// M√≥dulo: Estado de la Aplicaci√≥n
// =============================================
const AppState = {
    titles: [],
    musics: [],
    musicDances: [],
    currentPage: 1,
    sortOrder: 'asc',
    currentSortField: '',
    filteredMusicDances: [],
    dataRandom: [],
    playedMusic: [],
    mvst: new MoverEstructuras("0a1Ab@Bc#C2d$De%EfF^gG&hH3iI(Jj4)k-KlLm5Mn+NoOpPq6Q]rRSs}t|TuU;V7v:w8WxX9'y,Y=Zz<>?/`~ !_*[{")
};

// =============================================
// M√≥dulo: Utilidades
// =============================================
const Utils = {
    // Funci√≥n para cargar datos JSON
    async loadJSON(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
            return await response.json();
        } catch (error) {
            console.error('Error cargando datos:', error);
            return null;
        }
    },

    // Funci√≥n para cargar datos en partes
    async loadDataParts(baseUrl, type, processor) {
        let part = 1;
        let hasMoreData = true;

        while (hasMoreData) {
            const url = `${baseUrl}${type}_part${part}.json`;
            const data = await this.loadJSON(url);

            if (!data || data.length === 0) {
                hasMoreData = false;
            } else {
                processor(data);
                part++;
            }
        }
    },

    // Crear expresi√≥n regular para b√∫squeda con soporte para caracteres especiales
    createSearchRegex(searchValue) {
        const normalized = searchValue
            .replace(/[a√°]/gi, '[a√°]')
            .replace(/[e√©]/gi, '[e√©]')
            .replace(/[i√≠]/gi, '[i√≠]')
            .replace(/[o√≥]/gi, '[o√≥]')
            .replace(/[u√∫√º]/gi, '[u√∫√º]');
        return new RegExp(normalized, 'gi');
    },

    // Abreviar nombres de l√≠neas
    abbreviateLine(line) {
        return getPotencialsIcons(line);
    },

    // Eliminar elementos duplicados
    removeDuplicates(musicList) {
        const uniqueMusic = [];
        const seenMusic = new Set();

        for (const music of musicList) {
            const key = music.m.title + music.m.author;
            if (!seenMusic.has(key)) {
                uniqueMusic.push(music);
                seenMusic.add(key);
            }
        }

        return uniqueMusic;
    }
};

// =============================================
// M√≥dulo: Gesti√≥n de Datos
// =============================================
const DataManager = {
    // Procesar t√≠tulos
    processTitles(data) {
        AppState.titles = [...AppState.titles, ...data];
    },

    // Procesar m√∫sicas
    processMusics(data) {
        AppState.musics = [...AppState.musics, ...data];
    },

    // Combinar datos de m√∫sica y danza
    combineMusicAndDance() {
        AppState.titles.forEach((title) => {
            title.musics.forEach((musicRef) => {
                const music = AppState.musics.find(m => m._id === musicRef.id);
                if (music) {
                    AppState.musicDances.push({
                        m: {
                            id: music._id,
                            code: music.code,
                            title: music.title,
                            author: music.author,
                            line: music.line,
                            mp3: music.mp3,
                            ogg: music.ogg,
                            wd: (music.description.length > 20) ? music._id : ''
                        },
                        d: { 
                            id: title._id, 
                            title: title.title, 
                            dance: title.musics[0].d 
                        },
                        checked: false
                    });
                }
            });
        });
    },

    // Ordenar datos
    sortData() {
        // Primer ordenamiento por t√≠tulo y autor
        AppState.musicDances.sort((a, b) => {
            const aKey = a.m.title + a.m.author + (a.m.wd === '' ? "1" : "0");
            const bKey = b.m.title + b.m.author + (b.m.wd === '' ? "1" : "0");
            return aKey.localeCompare(bKey);
        });

        // Asignar referencias para m√∫sicas con descripci√≥n
        for (let i = 1; i < AppState.musicDances.length; i++) {
            if (AppState.musicDances[i - 1].m.title + AppState.musicDances[i - 1].m.author === 
                AppState.musicDances[i].m.title + AppState.musicDances[i].m.author) {
                AppState.musicDances[i].m.wd = AppState.musicDances[i - 1].m.wd;
            }
        }

        // Segundo ordenamiento por ID de danza y c√≥digo de m√∫sica
        AppState.musicDances.sort((a, b) => {
            const aKey = a.d.id + a.m.code + (a.m.wd === '' ? "1" : "0");
            const bKey = b.d.id + b.m.code + (b.m.wd === '' ? "1" : "0");
            return aKey.localeCompare(bKey);
        });

        // Eliminar duplicados
        AppState.musicDances = AppState.musicDances.filter((item, index, self) =>
            index === 0 || (item.m.code + item.d.id) !== (self[index - 1].m.code + self[index - 1].d.id)
        );

        // Ordenamiento final por t√≠tulo de danza, t√≠tulo y autor de m√∫sica
        AppState.musicDances.sort((a, b) => {
            const aKey = a.d.title + a.m.title + a.m.author;
            const bKey = b.d.title + b.m.title + b.m.author;
            return aKey.localeCompare(bKey);
        });
    },

    // Cargar y procesar todos los datos
    async loadAllData() {
        await Utils.loadDataParts(AppConfig.baseUrl, 'Title', this.processTitles);
        await Utils.loadDataParts(AppConfig.baseUrl, 'Music', this.processMusics);
        
        this.combineMusicAndDance();
        this.sortData();
    }
};

// =============================================
// M√≥dulo: Interfaz de Usuario - Tabla
// =============================================
const TableManager = {
    // Obtener datos para la p√°gina actual
    getPageData(searchValue = '', page = AppState.currentPage) {
        const searchTerms = searchValue.split(" ");
        const regexTerms = searchTerms.map(Utils.createSearchRegex);
        const isCheckedFilter = document.getElementById('filterChecked').checked;

        const fullText = (item) => 
            `${item.m.code} ${item.m.title} ${item.m.author} ${item.m.line} ${item.d.title}`;

        // Filtrar datos
        const filteredData = AppState.musicDances.filter(item => 
            (!isCheckedFilter || item.checked) && 
            regexTerms.every(term => fullText(item).toLowerCase().match(term))
        );

        const startIndex = AppConfig.itemsPerPage * (page - 1);

        // Actualizar datos para clipboard si el filtro de seleccionados est√° activo
        if (isCheckedFilter) {
            AppState.filteredMusicDances = filteredData.map(item => ({
                m: {
                    id: item.m.id,
                    code: item.m.code,
                    title: item.m.title,
                    author: item.m.author,
                    line: item.m.line
                },
                d: {
                    id: item.d.dance,
                    title: item.d.title
                }
            }));
            document.querySelector('#clickboard').classList.remove('invisible');
        } else {
            AppState.filteredMusicDances = [];
            document.querySelector('#clickboard').classList.add('invisible');
        }

        // Preparar datos para reproducci√≥n aleatoria
        AppState.dataRandom = Utils.removeDuplicates(filteredData);
        AppState.playedMusic = [];
        document.getElementById('random-monitor').textContent = 
            `${AppState.playedMusic.length} / ${AppState.dataRandom.length}`;

        // Actualizar estad√≠sticas
        this.updateStats(filteredData.length, page, filteredData.slice(startIndex, startIndex + AppConfig.itemsPerPage).length);

        return filteredData.slice(startIndex, startIndex + AppConfig.itemsPerPage);
    },

    // Actualizar estad√≠sticas
    updateStats(total, currentPage, showing) {
        const totalPages = Math.ceil(total / AppConfig.itemsPerPage);
        document.getElementById('total-registros').innerHTML = 
            `<strong>${total}</strong> items | P√°gina: <strong>${currentPage}</strong> / <strong>${totalPages}</strong> | Mostrando: <strong>${showing}</strong>`;

        const selectedCount = AppState.musicDances.filter(item => item.checked).length;
        document.getElementById('selected-count').textContent = 
            `${selectedCount} elementos seleccionados`;
    },

    // Renderizar tabla
    renderTable(searchValue = '') {
        const dataTable = document.getElementById('dataTable');
        const paginatedData = this.getPageData(searchValue, AppState.currentPage);

        if (paginatedData.length === 0) {
            dataTable.innerHTML = this.getEmptyTableHTML();
        } else {
            dataTable.innerHTML = paginatedData.map(item => this.getTableRowHTML(item)).join('');
        }
    },

    // HTML para tabla vac√≠a
    getEmptyTableHTML() {
        return `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <i class="bi bi-search display-4 text-muted"></i>
                    <p class="mt-2 text-muted">No se encontraron resultados</p>
                </td>
            </tr>
        `;
    },

    // HTML para una fila de la tabla
    getTableRowHTML(item) {
        return `
        <tr>
            <td>
                <button class="btn btn-success btn-sm" onclick="AudioManager.playMusic('${item.m.id}')">
                    <i class="bi bi-music-note-beamed"></i>
                </button>
            </td>
            <td nowrap style="cursor:pointer" class="${item.m.wd !== '' ? 'fw-bold text-dark danzo' : 'fw-bold text-dark'}" 
                ${item.m.wd !== '' ? `onclick="ModalManager.showMusicDetails('${item.m.wd}')"` : ''}>
                ${item.m.code}
                ${item.m.wd !== '' ? '<i class="bi bi-info-circle text-info ms-1"></i>' : ''}
            </td>
            <td class="small">
                <span class="text-primary">${item.m.title}</span></br>
                <span class="text-danger">${item.m.author}</span>
            </td>
            <td style="cursor:pointer" class="text-primary danzo" onclick="ModalManager.showDanceDetails('${item.d.id}')">
                ${item.d.title}
                <i class="bi bi-info-circle text-info ms-1"></i>
            </td>
            <td nowrap>
                <span class="music-line action-buttons">${Utils.abbreviateLine(item.m.line)}</span>
            </td>
            <td class="text-center">
                <input type="checkbox" class="form-check-input" 
                       onclick="TableManager.toggleItemSelection('${item.d.id}','${item.m.id}',this.checked)" 
                       ${item.checked ? 'checked' : ''}>
            </td>
        </tr>`;
    },

    // Cambiar selecci√≥n de un elemento
    toggleItemSelection(danceId, musicId, isChecked) {
        const item = AppState.musicDances.find(i => i.d.id === danceId && i.m.id === musicId);
        if (item) {
            item.checked = isChecked;
            this.renderTable(document.getElementById('searchInput').value);
            PaginationManager.render();
        }
    }
};

// =============================================
// M√≥dulo: Interfaz de Usuario - Paginaci√≥n
// =============================================
const PaginationManager = {
    // Renderizar paginaci√≥n
    render() {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(AppState.musicDances.length / AppConfig.itemsPerPage);
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        pagination.innerHTML = this.generatePaginationHTML(totalPages);
    },

    // Generar HTML de paginaci√≥n
    generatePaginationHTML(totalPages) {
        const maxButtons = 5;
        let startPage = Math.max(1, AppState.currentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);

        if (endPage - startPage < maxButtons - 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
        }

        return `
            ${this.getPageButtonHTML('first', 1, 'Primera p√°gina', 'bi-chevron-double-left', AppState.currentPage === 1)}
            ${this.getPageButtonHTML('prev', AppState.currentPage - 1, 'P√°gina anterior', 'bi-chevron-left', AppState.currentPage === 1)}
            ${this.getPageRangeHTML(startPage, endPage)}
            ${this.getPageButtonHTML('next', AppState.currentPage + 1, 'P√°gina siguiente', 'bi-chevron-right', AppState.currentPage === totalPages)}
            ${this.getPageButtonHTML('last', totalPages, '√öltima p√°gina', 'bi-chevron-double-right', AppState.currentPage === totalPages)}
        `;
    },

    // Generar bot√≥n de p√°gina
    getPageButtonHTML(type, page, title, icon, isDisabled) {
        return `
            <li class="page-item ${isDisabled ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="PaginationManager.changePage(${page})" title="${title}">
                    <i class="bi ${icon}"></i>
                </a>
            </li>
        `;
    },

    // Generar rango de p√°ginas
    getPageRangeHTML(start, end) {
        let html = '';
        for (let i = start; i <= end; i++) {
            html += `
                <li class="page-item ${AppState.currentPage === i ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="PaginationManager.changePage(${i})">${i}</a>
                </li>
            `;
        }
        return html;
    },

    // Cambiar p√°gina
    changePage(page) {
        AppState.currentPage = page;
        TableManager.renderTable(document.getElementById('searchInput').value);
        this.render();
    }
};

// =============================================
// M√≥dulo: Ordenamiento
// =============================================
const SortManager = {
    // Ordenar tabla
    sortTable(field) {
        if (AppState.currentSortField === field) {
            AppState.sortOrder = AppState.sortOrder === 'asc' ? 'desc' : 'asc';
        } else {
            AppState.currentSortField = field;
            AppState.sortOrder = 'asc';
        }
        
        const [object, property] = field.split('.');
        
        AppState.musicDances.sort((a, b) => {
            let valueA = a[object][property] || '';
            let valueB = b[object][property] || '';
            
            const comparison = valueA.toString().localeCompare(valueB.toString());
            return AppState.sortOrder === 'asc' ? comparison : -comparison;
        });

        this.updateSortIndicators(field);
        TableManager.renderTable(document.getElementById('searchInput').value);
        PaginationManager.render();
    },

    // Actualizar indicadores de ordenamiento
    updateSortIndicators(field) {
        document.querySelectorAll('th.sortable').forEach(th => {
            th.classList.remove('sort-asc', 'sort-desc');
        });
        
        const header = document.querySelector(`th[onclick="sortTable('${field}')"]`);
        if (header) {
            header.classList.add(AppState.sortOrder === 'asc' ? 'sort-asc' : 'sort-desc');
        }
    }
};

// =============================================
// M√≥dulo: Gesti√≥n de Audio
// =============================================
const AudioManager = {
    // Reproducir m√∫sica
    playMusic(musicId) {
        const music = AppState.musics.find(m => m._id === musicId);
        if (music) {
            loadAndPlayMusic(
                'audio-music', 
                AppState.mvst.des(music.code, music.mp3), 
                AppState.mvst.des(music.code, music.ogg), 
                music.code, 
                music.title, 
                music.author
            );
        }
    },

    // Reproducir m√∫sica aleatoria
    playRandomMusic() {
        if (AppState.playedMusic.length === AppState.dataRandom.length) {
            alert('Todas las canciones han sido reproducidas.');
            return;
        }

        let randomIndex;
        do {
            randomIndex = Math.floor(Math.random() * AppState.dataRandom.length);
        } while (AppState.playedMusic.includes(randomIndex));

        AppState.playedMusic.push(randomIndex);
        document.getElementById('random-monitor').textContent = 
            `${AppState.playedMusic.length} / ${AppState.dataRandom.length}`;

        const item = AppState.dataRandom[randomIndex];
        this.playMusic(item.m.id);
        
        // Configurar reproducci√≥n autom√°tica de la siguiente canci√≥n
        setTimeout(() => {
            document.getElementById('audio-music').onended = this.playRandomMusic;
        }, 2000);
    }
};

// =============================================
// M√≥dulo: Gesti√≥n de Modales
// =============================================
const ModalManager = {
    // Mostrar detalles de danza
    showDanceDetails(id) {
        const modalBody = document.getElementById('danceModalBody');
        const dance = AppState.titles.find(title => title._id === id);

        if (dance) {
            modalBody.innerHTML = `
                <p><strong>Danza:</strong> ${dance.title}</p>
                <p><strong>Descripci√≥n:</strong> ${AppState.mvst.des(id, dance.description)}</p>
            `;
            $('#danceModal').modal('show');
        }
    },

    // Mostrar detalles de m√∫sica
    showMusicDetails(id) {
        const modalBody = document.getElementById('musicModalBody');
        const music = AppState.musics.find(m => m._id === id);

        if (music) {
            modalBody.innerHTML = `
                <p><strong>M√∫sica:</strong> ${music.title} - ${music.author}</p>
                <p><strong>Descripci√≥n:</strong> ${AppState.mvst.des(music.code, music.description)}</p>
            `;
            $('#musicModal').modal('show');
        }
    }
};

// =============================================
// M√≥dulo: Portapapeles
// =============================================
const ClipboardManager = {
    // Copiar al portapapeles
    copyToClipboard() {
        const headers = "ID Musica\tCodigo\tTitulo\tAutor\tLinea\tID Danza\tTitulo Danza";
        const textToCopy = AppState.filteredMusicDances.map(item => 
            `${item.m.id}\t${item.m.code}\t${item.m.title}\t${item.m.author}\t${item.m.line}\t${item.d.id}\t${item.d.title}`
        ).join('\n');

        const fullText = `${headers}\n${textToCopy}`;

        navigator.clipboard.writeText(fullText).then(() => {
            alert('Las danzas y m√∫sicas seleccionadas han sido copiadas al portapapeles.');
        }).catch(err => {
            console.error('Error al copiar: ', err);
        });
    }
};

// =============================================
// M√≥dulo: Tema y Configuraci√≥n
// =============================================
const ThemeManager = {
    // Cargar tema
    loadTheme() {
        const urlParams = new URLSearchParams(window.location.search);
        const theme = urlParams.get('tema') || 'cerulean';

        if (AppConfig.themes.includes(theme)) {
            document.getElementById('tema').href = `bootstrap.min.${theme}.css`;
        } else {
            console.warn('Tema no v√°lido. Se cargar√° el tema por defecto.');
        }
    },

    // Verificar fecha de expiraci√≥n
    checkExpiration() {
        const params = new URLSearchParams(window.location.search);
        const encryptedDate = params.get('ff');
        
        if (encryptedDate) {
            const decryptedDate = new Date(atob(encryptedDate));
            
            function verifyDate() {
                const currentDate = new Date();
                if (currentDate > decryptedDate) {
                    document.getElementById('mb').innerHTML = "";
                    window.location.href = "https://ilovebiodanza.top";
                }
            }
            
            verifyDate();
            setInterval(verifyDate, 300000); // Verificar cada 5 minutos
        } else {
            document.getElementById('mb').innerHTML="";
            window.location.href = "https://ilovebiodanza.top";
        }
    }
};

// =============================================
// Inicializaci√≥n de la Aplicaci√≥n
// =============================================
const App = {
    // Inicializar aplicaci√≥n
    async init() {
        // Configurar eventos
        this.setupEventListeners();
        
        // Cargar tema
        ThemeManager.loadTheme();
        
        // Verificar expiraci√≥n
        ThemeManager.checkExpiration();
        
        // Cargar y mostrar datos
        await DataManager.loadAllData();
        TableManager.renderTable();
        PaginationManager.render();
    },

    // Configurar event listeners
    setupEventListeners() {
        // B√∫squeda
        document.getElementById('searchInput').addEventListener('input', (event) => {
            AppState.currentPage = 1;
            TableManager.renderTable(event.target.value);
            PaginationManager.render();
        });

        // Filtro de seleccionados
        document.getElementById('filterChecked').addEventListener('change', function() {
            document.getElementById('searchInput').value = '';
            AppState.currentPage = 1;
            TableManager.renderTable();
            PaginationManager.render();
        });

        // Bot√≥n de copiar al portapapeles
        document.querySelector('.btn-primary')?.addEventListener('click', ClipboardManager.copyToClipboard);
    }
};

// =============================================
// Inicializaci√≥n cuando el DOM est√° listo
// =============================================
document.addEventListener('DOMContentLoaded', function() {
    App.init();
});

// =============================================
// Funciones globales para compatibilidad con HTML
// =============================================
// Estas funciones mantienen la compatibilidad con los onclick en el HTML
function sortTable(field) {
    SortManager.sortTable(field);
}

function playRandomMusic() {
    AudioManager.playRandomMusic();
}

function copyToClipboard() {
    ClipboardManager.copyToClipboard();
}

function showDanceDetails(id) {
    ModalManager.showDanceDetails(id);
}

function showMusicDetails(id) {
    ModalManager.showMusicDetails(id);
}

// Funci√≥n global para compatibilidad
function changeChecked(danceId, musicId, isChecked) {
    TableManager.toggleItemSelection(danceId, musicId, isChecked);
}

// Funci√≥n global para compatibilidad
function lapm(id, mId) {
    AudioManager.playMusic(mId);
}
    </script>
</body>
</html>
