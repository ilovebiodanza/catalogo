<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Catálogo General de Biodanza</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4">Catálogo General de Biodanza</h1>
    <p class="lead">Recopilación exhaustiva y detallada de todas las danzas en los repertorios de Biodanza, incluyendo IBF 2012, IBF 2018, Buenos Aires, Areco, Perú y otros más, junto con sus respectivas músicas. Herramienta esencial para el profesor de Biodanza, que proporciona una visión completa de las diferentes danzas y músicas que forman parte de esta disciplina. Cada entrada en el catálogo incluirá el título de la danza, una descripción y la música correspondiente, proporcionando así una guía completa para su práctica.</p>
  </div>
</div>

<div class="container">
  <input class="form-control mb-3" id="myInput" type="text" placeholder="Escriba la palabra o frase que desea buscar">
  <table class="table table-bordered table-striped">
    <tbody id="myTable"></tbody>
  </table>  
</div>
<div id="new-translation" style="display:none">Reemplazar las traducciones vacías con las correspondientes en cada idioma : traduccion = {</div>
<script>
  async function cargarDatos(jsonFile) {
    try {
      const response = await fetch(jsonFile);
      if (!response.ok) throw new Error('Error en la red');
      return await response.json();
    } catch (error) {
      console.error('Hubo un problema con la solicitud Fetch:', error);
    }
  }

  const mostrarDanzas = async () => {
    const titles = await cargarDatos('Title.json');
    const musics = await cargarDatos('Music.json');
    const myTable = document.getElementById('myTable');

    titles.sort((a, b) => {
      return a.type.localeCompare(b.type) || a.title.localeCompare(b.title);
    });

    titles.forEach((t) => {
      if (t.type === 'Dance') {
        const tr = document.createElement('tr');
        if (t.musics) {
          t.musics.forEach((m, i) => {
            const resultado = musics.find(music => music._id === m.id);
            if (resultado) {
                t.musics[i] = resultado; // Actualiza la música con el resultado encontrado
            }
          });

          t.musics.sort((a, b) => a.code.localeCompare(b.code));

          tr.innerHTML = `
            <td>
              <h3 class="text-primary">${t.title}</h3>
              <p>${t.description}</p>
              <h5>Músicas</h5>
              <div class="list-group">
                ${t.musics.map(({ code, title, author, line, mp3, ogg }) => 
                  `<a href="javascript:playMusic(${"`"+mp3+"`"},${"`"+ogg+"`"})" class="list-group-item list-group-item-action">
                    <strong>${code}</strong> <span class="text-primary">${title}</span> <span class="text-danger">${author}</span> <i>${line}</i></a><br>`
                ).join('')}
              </div>
            </td>`;
          myTable.appendChild(tr);
        }
      }
    });
  };

  $(document).ready(function() {
    mostrarDanzas();
    $("#myInput").on("keyup", function() {
      const value = $(this).val().toLowerCase();
      $("#myTable tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
  });

  const playMusic = (mp3, ogg) => {
    const audio = document.getElementById("audio-music");
    audio.src=mp3!==''?mp3:ogg;
    audio.play();
  }
</script>
<div style="position: fixed; bottom: 10px; right: 10px; z-index: 9999;">
    <audio preload="none" id="audio-music" style="z-index: 9999;" controls></audio>
</div>
</body>
</html>
